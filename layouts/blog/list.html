
<li class="post">

    <div class="row post-container">
        <div class="photo-container">
            <div class="photo" role="img" aria-label='{{ index .Params "image-alt" }}'
                style="background-image: url('{{ .Params.thumb }}')"></div>
        </div>
        <div class="text-container">
            <div class="text">
                <div class="title"><a href="{{ .RelPermalink }}">
                        <h2>{{ .Title | markdownify }}</h2>
                        <!-- <h2>{{.Params.date}}</h2> -->
                    </a></div>
                <div class="date">
                    {{ if eq .Lang "en" }}                
                        {{ .Date.Format "Jan 2, 2006" }}
                    {{ end }}     

                    {{ if eq .Lang "fr" }}                
                        {{ .Date.Day }} {{ index $.Site.Data.mois (printf "%d" .Date.Month) }} {{ .Date.Year }} 
                    {{ end }}                 
                </div>
                <div class="author">{{ .Params.author }}</div>
                <div class="summary">{{ .Params.description | truncate 250 | markdownify }}</div>
                <div class="readmore">
                    <a href="{{ .Permalink }}" aria-label="Lire la suite de {{ .Params.title }}">{{ i18n "read-more" }}
                        <i class='fas fa-arrow-circle-right'></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</li>


<!-- <li class="post" id="blog-list">
    {{$pageData := (dict "blog" .Params) }}
    <div class="row post-container">
        <div class="text-container">
            <div class="text">
                <div class="title">
                    <h2 id="blog-title">{{$pageData.blog.title}}</h2>
                </div>
            </div>

        </div>

    </div>
    
    <script src="https://unpkg.com/lunr/lunr.js"></script>

    <script>
        let pagesIndex, searchIndex;
        const MAX_SUMMARY_LENGTH = 100;
        const SENTENCE_BOUNDARY_REGEX = /\b\.\s/gm;
        const WORD_REGEX = /\b(\w*)[\W|\s|\b]?/gm;
        async function initSearchIndex() {
            try {
                const response = await fetch("/index.json");
                const searchResults = document.getElementById('blog-title')
                

                pagesIndex = await response.json();
                // searchResults.innerHTML = pagesIndex.map((item) => {
                //     return item.title
                // })

                searchIndex = lunr(function () {
                    this.field("title");
                    this.field("author");
                    this.field("description");
                    this.ref("href");
                    this.field("date");
                    this.field("image");
                    this.field("image-alt");
                    this.field("translationKey");
                    this.field("thumb");
                    
                    pagesIndex.forEach((page) => this.add(page));
                });
            } catch (e) {
                console.log(e);
            }
        }

        function searchBoxFocused() {
            document.querySelector(".search-container").classList.add("focused");
            document
                .getElementById("search")
                .addEventListener("focusout", () => searchBoxFocusOut());
        }

        function searchBoxFocusOut() {
            document.querySelector(".search-container").classList.remove("focused");
        }

        initSearchIndex();

        document.addEventListener("DOMContentLoaded", function () {
            if (document.getElementById("search-form") != null) {
                const searchInput = document.getElementById("search");
                searchInput.addEventListener("focus", () => searchBoxFocused());
                searchInput.addEventListener("keydown", (event) => {
                    if (event.keyCode == 13) handleSearchQuery(event);
                });
                document
                    .querySelector(".search-error")
                    .addEventListener("animationend", removeAnimation);
                document
                    .querySelector(".fa-search")
                    .addEventListener("click", (event) => handleSearchQuery(event));
            }
        });

        function handleSearchQuery(event) {
            event.preventDefault();
            const query = document.getElementById("search").value.trim().toLowerCase();
            if (!query) {
                displayErrorMessage("Please enter a search term");
                return;
            }
            const results = searchSite(query);
            console.log(results);


              const searchResults = document.getElementById('blog-title')

              let resultList = ''
              for (var result of results) {
                resultList += result.title
              }

              searchResults.innerHTML = resultList;

            if (!results.length) {
                displayErrorMessage("Your search returned no results");
                return;
            }
        }

        function displayErrorMessage(message) {
            document.querySelector(".search-error-message").innerHTML = message;
            document.querySelector(".search-container").classList.remove("focused");
            document.querySelector(".search-error").classList.remove("hide-element");
            document.querySelector(".search-error").classList.add("fade");
        }

        function removeAnimation() {
            this.classList.remove("fade");
            this.classList.add("hide-element");
            document.querySelector(".search-container").classList.add("focused");
        }

        function searchSite(query) {
            const originalQuery = query;
            query = getLunrSearchQuery(query);
            let results = getSearchResults(query);

            return results.length
                ? results
                : query !== originalQuery
                    ? getSearchResults(originalQuery)
                    : [];
        }

        function getSearchResults(query) {
            return searchIndex.search(query).flatMap((hit) => {
                if (hit.ref == "undefined") return [];
                let pageMatch = pagesIndex.filter((page) => page.href === hit.ref)[0];
                pageMatch.score = hit.score;
                return [pageMatch];
            });
        }

        function getLunrSearchQuery(query) {
            const searchTerms = query.split(" ");
            if (searchTerms.length === 1) {
                return query;
            }
            query = "";
            for (const term of searchTerms) {
                query += `+${term} `;
            }
            return query.trim();
        }

    </script>
</li> -->